<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- leaflet cdn -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <style>
        body {
            height: 100vh;
            display: flex;
            /* flex-direction: column; */
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin: 0%;
            /* overflow-y: hidden; */
        }

        body * {
            box-sizing: border-box;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        .one {
            background: green;
            display: flex;
            flex-direction: column;
        }

        #map {
            height: 70vh;
            /* height: 100%; */
            width: 70vw;
            /* width: 100%; */
            margin-left: 1rem;
        }


        /* add loc  */
        .inputData {
            background: yellow;
            display: flex;

        }

        #addLocation {
            /* position: absolute; */
            top: 2rem;
            right: 26vw;
        }

        #send {}

        /* add per */

        .addLocBtns {
            background: black;
        }

        .addPerBtns {
            background: blue;
        }

        /* profile */
        .profile {
            background: red;
            height: 100%;
            width: 24%;
            align-self: flex-end;
            justify-self: end;
        }

        .main {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: green;

            text-align: center;
            /* overflow: default; */
            /* overflow-x: hidden; */
        }

        .title {
            border: 2px solid black;
            padding: 1rem 0;
            margin: 0%;
        }

        .mainImg {
            height: 6rem;
            width: 80%;
            /* background: url("./dewang-gupta-ESEnXckWlLY-unsplash.jpg"); */
            background: url("https://i.stack.imgur.com/dzokh.jpg?s=64&g=1");
            /* background: green; */
            z-index: 2;
            background-position: center center;
            text-align: center;
        }

        .log {
            /* display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; */
            box-sizing: border-box;
            overflow-y: scroll;
            background: blue;
            padding-top: 3rem;
            height: 75%;
            /* gap: .5rem; */
        }

        .per {
            /* height: 10rem; */
            width: 95%;
            background: rgb(86, 86, 255);
            background: white;
            text-align: center;
            border-radius: 1rem;
            box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
            padding: .3rem;
            margin: .3rem auto;
            /* box-sizing: border-box; */
        }

        .imgs {}

        .contr-imgs {
            background: rgb(58, 255, 101);
        }

        .befaft-imgs {
            background: rgb(144, 221, 161);
        }


        img {
            height: 5rem;
            width: 5rem;
            background: url("https://i.stack.imgur.com/dzokh.jpg?s=64&g=1");
            background-size: contain;
        }

        .date {
            color: rgb(49, 49, 49);
            font-family: 'Courier New', Courier, monospace;
        }

        .info {}
    </style>
</head>

<body>

    <div class="one">
        <button id="try">trying button</button>
        <div class="inputData">
            <!-- per -->
            <div class="addPerBtns">
                <input type="file" name="before">
                <input type="file" name="after">
                <input type="file" name="conts">
                <input type="text" name="" placeholder="info">
                <input type="" name="sendPer">
            </div>
            <!-- loc -->
            <div class="addLocBtns">
                <button id="addLocation" class="btn">اضافة موقع</button>
                <!--  -->

                <form action="upl" method="POST" enctype="multipart/form-data">
                    <input type="file" id="mainImage" name="main">
                    <input type="submit" placeholder="sub">
                    <!-- <button></button> -->
                </form>

                <input type="text" name="locationTitle" id="locationTitle">
                <button type="" name="sendLoc" id="send" class="btn"> ارسال</button>
            </div>

            <!--  -->
            <!-- <p><input type="file" accept="image/*" name="image" id="file" onchange="loadFile(event)"
                    style="display: none;"></p>
            <p><label for="file" style="cursor: pointer;">Upload Image</label></p>
            <p><img id="output" width="200" /></p> -->
            <!--  -->

        </div>
        <div id="map"></div>
    </div>

    <!-- <button id="addImage-after"></button> -->
    <!-- image uploading by js  -->
    <!-- image uploading; by form  -->
    <!-- <form action="upl" method="POST" enctype="multipart/form-data">
        <input type="file" name="inputTageName">
        <input type="submit">
    </form> -->


    <!-- profile -->
    <div class="profile">
        <!-- <title> العنوان اي اسم الجامع </title> -->
        <div class="main">
            <h2 class="title">عنوان (اسم الجامع)</h2>
            <div class="mainImg"></div>
        </div>
        <div class="log">
            <div class="per">
                <div class="imgs">
                    <div class="contr-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                    <div class="befaft-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                </div>
                <div class="date">22.5.2022</div>
                <div class="info">Lorem ipsum dolor sit amet consectetur adipisicing elit. Velit, natus.</div>
            </div>
            <div class="per">
                <div class="imgs">
                    <div class="contr-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                    <div class="befaft-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                </div>
                <div class="date">22.5.2022</div>
                <div class="info">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Maiores saepe omnis et
                    doloremque ab officiis nemo placeat. Libero officiis atque quos reprehenderit!</div>
            </div>
            <div class="per">
                <div class="imgs">
                    <div class="contr-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                    <div class="befaft-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                </div>
                <div class="date">22.5.2022</div>
                <div class="info">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Hic facere debitis aliquam
                    voluptate, id nulla harum excepturi sed illo dolore, voluptatem non!</div>
            </div>
            <div class="per">
                <div class="imgs">
                    <div class="contr-imgs">
                        <img alt="">
                        <img alt="">
                    </div>
                    <div class="befaft-imgs">
                        <img alt="">
                        <img alt="">
                    </div>

                </div>
                <div class="date">22.5.2022</div>
                <div class="info">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Hic facere debitis aliquam
                    voluptate, id nulla harum excepturi sed illo dolore, voluptatem non!</div>
            </div>


        </div>
    </div>

    <!-- main script  -->
    <script>
        ////setting up 

        const map = L.map('map').setView([36.238708, 42.496588], 13); //leaflet basic map
        //tile layer
        const apiKey = 'pk.eyJ1IjoiYWxmcmVkMjAxNiIsImEiOiJja2RoMHkyd2wwdnZjMnJ0MTJwbnVmeng5In0.E4QbAFjiWLY8k3AFhDtErA';

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: apiKey
        }).addTo(map);


        // stored data 
        //created objects data 
        let currentObject
        let tripleList = [] //[locaiton], title, img
        let per /// to add to log field at the intended document 


        ////set icons 
        let oldIcon = L.icon({
            iconUrl: "https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",
            shadowSize: [50, 64], // size of the shadow
            shadowAnchor: [4, 62], // the same for the shadow
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        });

        ////getting icon; icon is special object not just an image
        markerIcon = L.icon({
            iconUrl: "https://github.com/pointhi/leaflet-color-markers/blob/master/img/marker-icon-2x-red.png?raw=true",
            shadowSize: [50, 64], // size of the shadow
            shadowAnchor: [4, 62], // the same for the shadow
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        });


        let loadFile = function (event) {
            let image = document.getElementById('output');
            image.src = URL.createObjectURL(event.target.files[0]);
            fetch("/upl", {
                method: "POST",
                // headers: {
                //     'Content-Type': 'multipart/form-data',
                //     "boundary": "MyBoundary"
                // },
                body: event.target.files[0]
            })
        };


        //get data and deploy them

        window.onload = async () => {
            ///fetching data; 
            let data = await fetch("/confirmed")
            let rdata = await data.json()
            console.log("get routes; ")
            console.log(rdata)

            ///deploy them; store
            Object.values(rdata.map(e => e.path)).forEach(e => {

                let label = L.marker(e.coords).addTo(map)

                let mainImg = document.createElement("div")
                // mainImg.
                // let log

                tripleList.push([label, log, e._id])


                if (e.length != 1) { ////routes part
                    let pathob = L.polyline(e, {
                        color: "red",
                    }).addTo(map)
                    // oldObjects.push(pathId) //dont need old objects
                    pathob.addEventListener("click", (e) => console.log(e.target))
                } else { ////labels part 
                    let label = L.circle(e.path, {
                        fillColor: '#3388FF',
                        fillOpacity: 0.8,
                        radius: 100
                    }).addTo(map)
                }
            })
        }





        /////// features 
        //adding label

        let addmode = document.querySelector("#add-mode")
        addmode.addEventListener("click", () => {
            addmode.classList.toggle("on")

            if (addmode.classList.contains("on")) {
                addmode.style.background = "red"
            } else {
                addmode.style.background = "green"
            }
        })

        map.addEventListener('click', function (ev) {
            if (addmode.classList.contains("on")) {
                let latlng = map.mouseEventToLatLng(ev.originalEvent);
                let i = [latlng.lat, latlng.lng]
                let m = L.marker(i, {
                    icon: oldIcon
                }).addTo(map);
                mobject.push(m)

                ////marker 
                m.addEventListener("click", (e) => {
                    // change label color
                    mobject.forEach(ee => {
                        ee.setIcon(oldIcon)
                    })
                    e.target.setIcon(markerIcon)
                    currentLabel = e.target._latlng
                    console.log(currentLabel)
                })
                ////containers reset 
                // path.push(i)
                // currentPath != 0 ? map.removeLayer(currentPath) : null
                // currentPath = L.polyline(path).addTo(map)
            }
        });



        //// adding label; 

        let addCircle = document.querySelector("#addLocation")
        addCircle.onclick = () => {
            // map.marker(currentLabel)

            console.log("addcircle to" + currentLabel)
            let m = L.circle(currentLabel, {
                // color: 'red',
                fillColor: '#3388FF',
                fillOpacity: 0.8,
                radius: 100
            }).addTo(map)

            labelList.push([currentLabel.lat, currentLabel.lng])
            ps.push([currentLabel.lat, currentLabel.lng])
            pathObjects.push(m)
        }


        //canceling

        //cancel step
        let cancelStep = document.querySelector("#cancel-step")
        cancelStep.addEventListener("click", () => {

        })


        ///////sending 
        let send = document.querySelector("#send")
        send.addEventListener("click", () => {

            // console.log()


            // fetch("/unconfirmed", {
            //     method: "POST",
            //     headers: {
            //         'Content-Type': 'application/json'
            //     },
            //     body: JSON.stringify(labelList)
            // })
            // labelList = []

        })



        //////////// test code; 
        window.onclick = () => {}
    </script>


</body>

</html>