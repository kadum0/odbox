<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- leaflet cdn -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <style>
        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 0%;
        }

        #map {
            height: 70vh;
            width: 70vw;
        }

        button {
            padding: .4rem;
            background: "#148042";
            cursor: pointer;
            font-size: 1.5rem;
        }

        .deletebtns {
            padding: .5rem;
            border: 2px dashed black;
        }

        .deletebtns button {
            display: block;
            margin: .2rem;
        }

        .btns {
            display: flex;
            flex-direction: column;
            gap: .4rem;
            font-size: 2.4rem;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div class="btns">
        <!-- <button id="add-mode">اضافة</button> -->
        <!-- <input type="file" value="اضافة مشاركة"> -->
        <div>
            <label for="files" class="btn">اضافة مشاركة</label>
            <input id="files" type="file" style="opacity: .4;">
        </div>
        <button id="send"> ارسال</button>

    </div>

    <!-- main script  -->
    <script>
        ////setting up 

        const map = L.map('map').setView([36.238708, 42.496588], 13); //leaflet basic map
        //tile layer
        const apiKey = 'pk.eyJ1IjoiYWxmcmVkMjAxNiIsImEiOiJja2RoMHkyd2wwdnZjMnJ0MTJwbnVmeng5In0.E4QbAFjiWLY8k3AFhDtErA';

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: apiKey
        }).addTo(map);


        // stored data 
        ////current ID
        let currentID


        ////set icons 
        let oldIcon = L.icon({
            iconUrl: "https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",
            shadowSize: [50, 64], // size of the shadow
            shadowAnchor: [4, 62], // the same for the shadow
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        });


        ////getting icon; icon is special object not just an image
        markerIcon = L.icon({
            iconUrl: "https://github.com/pointhi/leaflet-color-markers/blob/master/img/marker-icon-2x-red.png?raw=true",
            shadowSize: [50, 64], // size of the shadow
            shadowAnchor: [4, 62], // the same for the shadow
            iconSize: [25, 41],
            iconAnchor: [12, 41],
        });



        //get data and deploy them
        ////triple linked list
        //make the dom elements; labels, profile, adding a per conts panel 
        ///addeventlistener for them; 
        ///show the related dom element 
        ///set the current id to the selected element id 

        window.onload = async () => {
            ///fetching data; 
            let data = await fetch("/confirmed")
            let rdata = await data.json()
            console.log("get routes; ")
            console.log(rdata)

            ///deploy them; store
            Object.values(rdata.map(e => e.path)).forEach(e => {

                if (e.length != 1) { ////routes part
                    let pathob = L.polyline(e, {
                        color: "red",
                    }).addTo(map)
                    // oldObjects.push(pathId) //dont need old objects
                    pathob.addEventListener("click", (e) => console.log(e.target))
                } else { ////labels part 
                    let label = L.circle(e.path, {
                        fillColor: '#3388FF',
                        fillOpacity: 0.8,
                        radius: 100
                    }).addTo(map)
                }
            })
        }





        /////// features 

        /////add per conts images


        ///////sending 
        let send = document.querySelector("#send")
        send.addEventListener("click", () => {

        })




        //////////// test code; 
        window.onclick = () => {}
    </script>


</body>

</html>